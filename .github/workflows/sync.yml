name: Sync
on:
  schedule:
    - cron: "*/5 * * * *"

jobs:
  sync_ios:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          repository: corona-warn-app/cwa-app-ios
          ref: development
          fetch-depth: 0
      - run: |
          mkdir ~/.ssh
          chmod -R 700 ~/.ssh
      - run: |
          echo $SSH_PUB_KEY > ~/.ssh/id_ed25519.pub
          chmod 644 ~/.ssh/id_ed25519.pub
      - run: |
          echo $SSH_KEY | base64 -d > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
      - run: |
          git config --local user.email "action@github.com"
          git config --local user.name "github-actions"
          git push -f git@github.com:cosee/cwa-app-ios.git development
    env:
      SSH_KEY: ${{ secrets.IOS_SSH_KEY }}
      SSH_PUB_KEY:  ${{ secrets.IOS_SSH_PUB_KEY }}
  sync_android:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          repository: corona-warn-app/cwa-app-android
          ref: dev
          fetch-depth: 0
      - run: |
          mkdir ~/.ssh
          chmod -R 700 ~/.ssh
      - run: |
          echo $SSH_PUB_KEY > ~/.ssh/id_ed25519.pub
          chmod 644 ~/.ssh/id_ed25519.pub
      - run: |
          echo $SSH_KEY | base64 -d > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
      - run: |
          git config --local user.email "action@github.com"
          git config --local user.name "github-actions"
          git push -f git@github.com:cosee/cwa-app-android.git dev
    env:
      SSH_KEY: ${{ secrets.ANDROID_SSH_KEY }}
      SSH_PUB_KEY:  ${{ secrets.ANDROID_SSH_PUB_KEY }}
